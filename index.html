<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Bitcoin Câmbio P2P</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #02030a;
      color: #f5f5f5;
    }

    .container {
      max-width: 1080px;
      margin: 0 auto;
      padding: 16px;
    }

    /* HERO / LOGO / BANNER */

    .hero {
      position: relative;
      border-radius: 18px;
      padding: 20px 16px 22px;
      margin-top: 12px;
      margin-bottom: 10px;
      overflow: hidden;
      background: radial-gradient(circle at top left, #ffb300 0, #ff6f00 20%, #0b1020 55%, #02030a 100%);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.18;
      background:
        linear-gradient(120deg, transparent 0 40%, rgba(255,255,255,0.15) 50%, transparent 60%),
        repeating-linear-gradient(
          -8deg,
          rgba(255,255,255,0.12) 0,
          rgba(255,255,255,0.12) 2px,
          transparent 2px,
          transparent 10px
        );
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .hero-cartoon {
      position: absolute;
      right: -20px;
      bottom: -10px;
      width: 280px;
      max-width: 55%;
      opacity: 0.55;
      pointer-events: none;
    }

    /* AQUI você pode trocar por uma imagem cartoon da Ponte da Amizade.
       Ex: background-image: url('ponte-cartoon.png'); */
    .hero-cartoon::before {
      content: "Ponte da Amizade - Ilustração Cartoon";
      position: absolute;
      right: 16px;
      bottom: 30px;
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
      transform: rotate(-6deg);
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 60%;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(2, 3, 10, 0.65);
      backdrop-filter: blur(6px);
      margin-bottom: 8px;
    }

    .logo-mark {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.1rem;
      background: radial-gradient(circle at 30% 20%, #fff8e1 0, #ff9800 45%, #e65100 100%);
      color: #1b1400;
      box-shadow: 0 0 12px rgba(255, 193, 7, 0.9);
    }

    .logo-text {
      font-weight: 700;
      font-size: 0.95rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #ffecb3;
    }

    .hero-title {
      margin: 2px 0 4px;
      font-size: 1.7rem;
      font-weight: 800;
      color: #fff8e1;
    }

    .hero-subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: #ffe0b2;
    }

    header {
      margin-bottom: 8px;
    }

    .section-title {
      margin: 0;
      font-size: 1.2rem;
      color: #ffb300;
    }

    .section-subtitle {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: #d0d0d0;
    }

    .card {
      background: #0b1020;
      border-radius: 14px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255,255,255,0.04);
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #e0e0e0;
    }

    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #222842;
      background: #050816;
      color: #f5f5f5;
      font-size: 0.95rem;
    }

    input:focus, select:focus, textarea:focus {
      outline: 2px solid #ffb300;
      outline-offset: 1px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .col-6 {
      flex: 1 1 220px;
    }

    .results {
      margin-top: 12px;
      padding: 10px;
      background: #050816;
      border-radius: 8px;
      font-size: 0.9rem;
      border: 1px solid #222842;
    }

    .results strong {
      color: #ffb300;
    }

    .btn-whatsapp {
      margin-top: 16px;
      background: #25d366;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-whatsapp:hover {
      filter: brightness(1.1);
    }

    .small-text {
      font-size: 0.8rem;
      color: #b0b0b0;
      margin-top: 6px;
    }

    footer {
      text-align: center;
      font-size: 0.75rem;
      color: #777;
      margin: 24px 0 8px;
    }

    .ticker {
      font-size: 0.8rem;
      margin-top: 8px;
      padding: 8px;
      border-radius: 8px;
      background: #050816;
      border: 1px solid #222842;
    }

    .ticker span {
      display: inline-block;
      margin-right: 12px;
      margin-bottom: 4px;
    }

    @media (max-width: 720px) {
      .hero-content {
        max-width: 100%;
      }
      .hero-cartoon {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- HERO + LOGO + BANNER CARTOON -->
    <section class="hero">
      <div class="hero-content">
        <div class="logo">
          <span class="logo-mark">₿</span>
          <span class="logo-text">Bitcoin Câmbio P2P</span>
        </div>
        <h1 class="hero-title">Cripto P2P e Câmbio em Ciudad del Este</h1>
        <p class="hero-subtitle">
          Compra e venda de Bitcoin, Ethereum e USDT · Pagamento em Guaranis ou PIX em Real · Atendimentos via WhatsApp.
        </p>
      </div>
      <!-- Placeholder da ilustração cartoon da Ponte da Amizade -->
      <div class="hero-cartoon"></div>
    </section>

    <!-- COTAÇÕES GERAIS -->
    <section class="card">
      <header>
        <h2 class="section-title">Cotações agora</h2>
        <p class="section-subtitle">
          Preços aproximados com ajustes já aplicados para operações no site.
        </p>
      </header>
      <div class="ticker" id="ticker">
        Carregando cotações...
      </div>
    </section>

    <!-- CALCULADORA CRIPTO P2P -->
    <section class="card">
      <header>
        <h2 class="section-title">Calculadora Cripto P2P</h2>
        <p class="section-subtitle">
          Digite o valor em <strong>Guaranis (PYG)</strong>. Para criptomoedas, é aplicada taxa de
          <strong>5% de serviço</strong> sobre o valor em USD.
        </p>
      </header>

      <div class="row" style="margin-top: 8px;">
        <div class="col-6">
          <label for="moeda">Criptomoeda</label>
          <select id="moeda">
            <option value="BTC">BTC - Bitcoin</option>
            <option value="ETH">ETH - Ethereum</option>
            <option value="USDT">USDT - Tether (USD)</option>
          </select>
        </div>
        <div class="col-6">
          <label for="tipoOperacao">Operação</label>
          <select id="tipoOperacao">
            <option value="comprar">Comprar</option>
            <option value="vender">Vender</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="col-6">
          <label for="valorPYG">Valor em Guaranis (PYG)</label>
          <input type="number" id="valorPYG" placeholder="Ex: 1000000" step="1" min="0" />
          <div class="small-text" id="equivalenteUSD">
            Equivalente aproximado em USD: -
          </div>
          <div class="small-text" id="equivalenteBRL">
            Equivalente aproximado em BRL: -
          </div>
        </div>
      </div>

      <div class="results" id="resultadoCotacao">
        Selecione a criptomoeda e informe o valor em PYG para simular a operação.
      </div>
    </section>

    <!-- CÂMBIO FÍSICO SEPARADO -->
    <section class="card">
      <header>
        <h2 class="section-title">Câmbio Físico · Guaranis, Dólar e Real</h2>
        <p class="section-subtitle">
          Conversão entre USD, BRL e PYG para operações em dinheiro ou PIX. Sem taxa de 5%.
        </p>
      </header>

      <div class="row" style="margin-top: 8px;">
        <div class="col-6">
          <label for="fxDirecao">Tipo de operação</label>
          <select id="fxDirecao">
            <option value="USD_PYG">USD → PYG</option>
            <option value="BRL_PYG">BRL → PYG</option>
            <option value="PYG_USD">PYG → USD</option>
            <option value="PYG_BRL">PYG → BRL</option>
          </select>
        </div>
        <div class="col-6">
          <label for="fxValor">Valor</label>
          <input type="number" id="fxValor" placeholder="Ex: 100 (USD/BRL) ou 100000 (PYG)" step="0.01" min="0" />
        </div>
      </div>

      <div class="results" id="fxResultado">
        Informe um valor e escolha a direção do câmbio para simular.
      </div>
    </section>

    <!-- FORMULÁRIO P2P (WHATSAPP) -->
    <section class="card">
      <header>
        <h2 class="section-title">Solicitação P2P pelo WhatsApp</h2>
        <p class="section-subtitle">
          Preencha os dados abaixo. No envio, abriremos uma conversa com todos os detalhes da operação.
        </p>
      </header>

      <div class="row" style="margin-top: 10px;">
        <div class="col-6">
          <label for="nome">Nome completo</label>
          <input type="text" id="nome" placeholder="Seu nome" />
        </div>
        <div class="col-6">
          <label for="telefone">Telefone (WhatsApp)</label>
          <input type="tel" id="telefone" placeholder="+595 9xx xxx xxx" />
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="col-6">
          <label for="moedaForm">Tipo de operação</label>
          <select id="moedaForm">
            <option value="BTC">BTC - Bitcoin</option>
            <option value="ETH">ETH - Ethereum</option>
            <option value="USDT">USDT - Tether (USD)</option>
            <option value="PYG">PYG - Câmbio físico (Guaranis)</option>
          </select>
        </div>

        <div class="col-6">
          <label for="tipoOperacaoForm">Comprar ou vender</label>
          <select id="tipoOperacaoForm">
            <option value="comprar">Comprar</option>
            <option value="vender">Vender</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="col-6">
          <label for="valorPYGForm">Valor em Guaranis (PYG)</label>
          <input type="number" id="valorPYGForm" placeholder="Ex: 500000" step="1" min="0" />
        </div>
        <div class="col-6">
          <label for="pagamento">Forma de pagamento</label>
          <select id="pagamento">
            <option value="Pix BRL">Pix em Real (BRL)</option>
            <option value="Pix PYG">Pix em Guaranis (PYG)</option>
            <option value="Dinheiro">Dinheiro (efectivo)</option>
            <option value="Criptomoedas">Criptomoedas</option>
          </select>
        </div>
      </div>

      <label style="margin-top: 12px;" for="observacoes">Observações (opcional)</label>
      <textarea id="observacoes" rows="3" placeholder="Banco, horário preferido, rede da cripto, etc."></textarea>

      <button class="btn-whatsapp" id="btnWhatsapp">
        Enviar pedido para o WhatsApp
      </button>

      <div class="small-text">
        Confirme sempre os dados de depósito antes de enviar valores.
      </div>
    </section>

    <footer>
      Bitcoin Câmbio P2P · Atendimento personalizado · Cripto + câmbio físico em Ciudad del Este.
    </footer>
  </div>

  <script>
    // =========================
    // CONFIGURAÇÃO / ESTADO
    // =========================

    const spreadPercent = 0.01;        // 1% embutido no preço final
    const taxaCryptoPercent = 0.05;    // 5% apenas para criptomoedas

    const rates = {
      BTC: null,
      ETH: null,
      USDT: 1,
      USD_PYG: null,
      USD_BRL: null
    };

    const tickerDiv = document.getElementById("ticker");
    const resultadoCotacaoDiv = document.getElementById("resultadoCotacao");
    const equivalenteUSDSpan = document.getElementById("equivalenteUSD");
    const equivalenteBRLSpan = document.getElementById("equivalenteBRL");

    const moedaSelect = document.getElementById("moeda");
    const tipoOperacaoSelect = document.getElementById("tipoOperacao");
    const valorPYGInput = document.getElementById("valorPYG");

    const fxDirecaoSelect = document.getElementById("fxDirecao");
    const fxValorInput = document.getElementById("fxValor");
    const fxResultadoDiv = document.getElementById("fxResultado");

    function formatMoney(value, decimals = 2) {
      return value.toLocaleString("pt-BR", {
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function isCrypto(moeda) {
      return ["BTC", "ETH", "USDT"].includes(moeda);
    }

    // =========================
    // BUSCA DE COTAÇÕES (APIs)
    // =========================

    async function fetchRates() {
      try {
        const [btcRes, ethRes, fxRes] = await Promise.all([
          fetch("https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT"),
          fetch("https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT"),
          fetch("https://open.er-api.com/v6/latest/USD")
        ]);

        const btcData = await btcRes.json();
        const ethData = await ethRes.json();
        const fxData = await fxRes.json();

        if (btcData && btcData.price) {
          rates.BTC = parseFloat(btcData.price);
        }
        if (ethData && ethData.price) {
          rates.ETH = parseFloat(ethData.price);
        }
        if (fxData && fxData.rates) {
          if (fxData.rates.PYG) rates.USD_PYG = parseFloat(fxData.rates.PYG);
          if (fxData.rates.BRL) rates.USD_BRL = parseFloat(fxData.rates.BRL);
        }

        if (!rates.USD_PYG) rates.USD_PYG = 7500; // fallback
        if (!rates.USD_BRL) rates.USD_BRL = 5.5;  // fallback

        atualizarTicker();
        atualizarSimulacaoCripto();
        atualizarCambioFisico();
      } catch (e) {
        console.error("Erro ao buscar cotações:", e);

        if (!rates.BTC) rates.BTC = 70000;
        if (!rates.ETH) rates.ETH = 3500;
        if (!rates.USD_PYG) rates.USD_PYG = 7500;
        if (!rates.USD_BRL) rates.USD_BRL = 5.5;

        tickerDiv.textContent = "Usando cotações aproximadas (não foi possível atualizar em tempo real).";
        atualizarSimulacaoCripto();
        atualizarCambioFisico();
      }
    }

    function atualizarTicker() {
      if (!rates.USD_PYG || !rates.USD_BRL) {
        tickerDiv.textContent = "Carregando cotações...";
        return;
      }

      const parts = [];

      if (rates.BTC) {
        const btcFinal = rates.BTC * (1 + spreadPercent);
        parts.push(`<span><strong>BTC:</strong> ~ US$ ${formatMoney(btcFinal)}</span>`);
      }

      if (rates.ETH) {
        const ethFinal = rates.ETH * (1 + spreadPercent);
        parts.push(`<span><strong>ETH:</strong> ~ US$ ${formatMoney(ethFinal)}</span>`);
      }

      parts.push(`<span><strong>USDT:</strong> US$ 1,00</span>`);
      parts.push(`<span><strong>1 USD ≈</strong> ${formatMoney(rates.USD_PYG, 0)} PYG</span>`);
      parts.push(`<span><strong>1 USD ≈</strong> R$ ${formatMoney(rates.USD_BRL)}</span>`);

      tickerDiv.innerHTML = parts.join(" ");
    }

    // =========================
    // SIMULAÇÃO CRIPTO P2P
    // =========================

    function atualizarSimulacaoCripto() {
      const moeda = moedaSelect.value;
      const tipoOperacao = tipoOperacaoSelect.value;
      const valorPYG = parseFloat(valorPYGInput.value || "0");

      if (!rates.USD_PYG || !rates.USD_BRL) {
        resultadoCotacaoDiv.textContent = "Aguardando cotações em tempo real...";
        return;
      }

      if (!valorPYG || valorPYG <= 0) {
        resultadoCotacaoDiv.textContent = "Informe um valor em PYG para simular a operação.";
        equivalenteUSDSpan.textContent = "Equivalente aproximado em USD: -";
        equivalenteBRLSpan.textContent = "Equivalente aproximado em BRL: -";
        return;
      }

      const valorUSDbase = valorPYG / rates.USD_PYG;
      const valorBRLbase = valorUSDbase * rates.USD_BRL;

      equivalenteUSDSpan.textContent = `Equivalente aproximado em USD: US$ ${formatMoney(valorUSDbase)}`;
      equivalenteBRLSpan.textContent = `Equivalente aproximado em BRL: R$ ${formatMoney(valorBRLbase)}`;

      if (!isCrypto(moeda)) {
        resultadoCotacaoDiv.textContent = "Selecione uma criptomoeda válida.";
        return;
      }

      if (moeda === "BTC" && !rates.BTC) {
        resultadoCotacaoDiv.textContent = "Cotação de BTC indisponível no momento.";
        return;
      }
      if (moeda === "ETH" && !rates.ETH) {
        resultadoCotacaoDiv.textContent = "Cotação de ETH indisponível no momento.";
        return;
      }

      const precoRef =
        moeda === "BTC" ? rates.BTC :
        moeda === "ETH" ? rates.ETH :
        1; // USDT

      let precoFinal = precoRef;
      if (moeda === "BTC" || moeda === "ETH") {
        precoFinal = precoRef * (1 + spreadPercent); // preço já com ajuste
      }

      const quantidade = valorUSDbase / precoFinal;
      const taxaServico = valorUSDbase * taxaCryptoPercent;

      let totalUSD;
      let textoOperacao;

      if (tipoOperacao === "comprar") {
        totalUSD = valorUSDbase + taxaServico;
        textoOperacao = "Total aproximado a pagar";
      } else {
        totalUSD = valorUSDbase - taxaServico;
        textoOperacao = "Total aproximado a receber";
      }

      const totalPYGFinal = totalUSD * rates.USD_PYG;
      const totalBRLFinal = totalUSD * rates.USD_BRL;

      resultadoCotacaoDiv.innerHTML = `
        <div><strong>Criptomoeda:</strong> ${moeda}</div>
        <div><strong>Operação:</strong> ${tipoOperacao === "comprar" ? "Comprar" : "Vender"}</div>
        <div><strong>Valor digitado (base) em PYG:</strong> ${formatMoney(valorPYG, 0)} PYG</div>
        <div><strong>Valor base em USD (sem taxa):</strong> US$ ${formatMoney(valorUSDbase)}</div>
        <div><strong>Valor base em BRL (sem taxa):</strong> R$ ${formatMoney(valorBRLbase)}</div>
        <hr />
        <div><strong>Preço estimado utilizado:</strong> US$ ${formatMoney(precoFinal)} por 1 ${moeda}</div>
        <div style="margin-top:6px;"><strong>Quantidade aproximada:</strong> ${quantidade.toFixed(8)} ${moeda}</div>
        <div><strong>Taxa de serviço (5% sobre o valor em USD):</strong> US$ ${formatMoney(taxaServico)}</div>
        <div style="margin-top:6px;">
          <strong>${textoOperacao}:</strong><br>
          • US$ ${formatMoney(totalUSD)}<br>
          • ~ ${formatMoney(totalPYGFinal, 0)} PYG<br>
          • ~ R$ ${formatMoney(totalBRLFinal)}
        </div>
        <div class="small-text" style="margin-top:6px;">
          Valores aproximados. Podem variar conforme liquidez, rede e horário da operação.
        </div>
      `;
    }

    // =========================
    // CÂMBIO FÍSICO
    // =========================

    function atualizarCambioFisico() {
      const direcao = fxDirecaoSelect.value;
      const valor = parseFloat(fxValorInput.value || "0");

      if (!rates.USD_PYG || !rates.USD_BRL) {
        fxResultadoDiv.textContent = "Aguardando cotações em tempo real...";
        return;
      }

      if (!valor || valor <= 0) {
        fxResultadoDiv.textContent = "Informe um valor para simular o câmbio físico.";
        return;
      }

      let texto = "";

      if (direcao === "USD_PYG") {
        const valorUSD = valor;
        const valorPYG = valorUSD * rates.USD_PYG * (1 + spreadPercent);
        texto = `
          <div><strong>Você entrega:</strong> US$ ${formatMoney(valorUSD)}</div>
          <div><strong>Você recebe aproximadamente:</strong> ${formatMoney(valorPYG, 0)} PYG</div>
        `;
      } else if (direcao === "BRL_PYG") {
        const valorBRL = valor;
        const valorUSD = valorBRL / rates.USD_BRL;
        const valorPYG = valorUSD * rates.USD_PYG * (1 + spreadPercent);
        texto = `
          <div><strong>Você entrega:</strong> R$ ${formatMoney(valorBRL)}</div>
          <div><strong>Você recebe aproximadamente:</strong> ${formatMoney(valorPYG, 0)} PYG</div>
        `;
      } else if (direcao === "PYG_USD") {
        const valorPYG = valor;
        const valorUSD = valorPYG / (rates.USD_PYG * (1 + spreadPercent));
        texto = `
          <div><strong>Você entrega:</strong> ${formatMoney(valorPYG, 0)} PYG</div>
          <div><strong>Você recebe aproximadamente:</strong> US$ ${formatMoney(valorUSD)}</div>
        `;
      } else if (direcao === "PYG_BRL") {
        const valorPYG = valor;
        const valorUSD = valorPYG / (rates.USD_PYG * (1 + spreadPercent));
        const valorBRL = valorUSD * rates.USD_BRL;
        texto = `
          <div><strong>Você entrega:</strong> ${formatMoney(valorPYG, 0)} PYG</div>
          <div><strong>Você recebe aproximadamente:</strong> R$ ${formatMoney(valorBRL)}</div>
        `;
      }

      texto += `
        <div class="small-text" style="margin-top:6px;">
          Não há taxa de 5% no câmbio físico. Valores aproximados com base na cotação do momento.
        </div>
      `;

      fxResultadoDiv.innerHTML = texto;
    }

    moedaSelect.addEventListener("change", atualizarSimulacaoCripto);
    tipoOperacaoSelect.addEventListener("change", atualizarSimulacaoCripto);
    valorPYGInput.addEventListener("input", atualizarSimulacaoCripto);

    fxDirecaoSelect.addEventListener("change", atualizarCambioFisico);
    fxValorInput.addEventListener("input", atualizarCambioFisico);

    // =========================
    // ENVIO PARA WHATSAPP
    // =========================

    document.getElementById("btnWhatsapp").addEventListener("click", function () {
      const nome = document.getElementById("nome").value.trim();
      const telefoneCliente = document.getElementById("telefone").value.trim();
      const moedaForm = document.getElementById("moedaForm").value;
      const tipoOperacaoForm = document.getElementById("tipoOperacaoForm").value;
      const valorPYGForm = parseFloat(document.getElementById("valorPYGForm").value || "0");
      const pagamento = document.getElementById("pagamento").value;
      const observacoes = document.getElementById("observacoes").value.trim();

      if (!nome || !telefoneCliente || !valorPYGForm || valorPYGForm <= 0) {
        alert("Preencha nome, telefone e valor em PYG para enviar o pedido.");
        return;
      }

      if (!rates.USD_PYG || !rates.USD_BRL) {
        alert("Cotações ainda não carregadas. Tente novamente em alguns segundos.");
        return;
      }

      const isCriptoForm = isCrypto(moedaForm);
      const valorUSDFormBase = valorPYGForm / rates.USD_PYG;
      const valorBRLFormBase = valorUSDFormBase * rates.USD_BRL;

      let precoRef = 1;
      if (moedaForm === "BTC") precoRef = rates.BTC || 70000;
      else if (moedaForm === "ETH") precoRef = rates.ETH || 3500;
      else if (moedaForm === "USDT") precoRef = 1;
      else if (moedaForm === "PYG") precoRef = rates.USD_PYG;

      let precoFinal = precoRef;

      if (isCriptoForm && (moedaForm === "BTC" || moedaForm === "ETH")) {
        precoFinal = precoRef * (1 + spreadPercent);
      } else if (!isCriptoForm && moedaForm === "PYG") {
        precoFinal = rates.USD_PYG * (1 + spreadPercent);
      }

      let taxaServicoForm = 0;
      let totalUSDForm = valorUSDFormBase;
      let totalPYGFormFinal = valorPYGForm;
      let totalBRLFormFinal = valorBRLFormBase;
      let quantidadeForm = 0;
      let textoOperacaoForm;

      if (isCriptoForm) {
        quantidadeForm = valorUSDFormBase / precoFinal;
        taxaServicoForm = valorUSDFormBase * taxaCryptoPercent;

        if (tipoOperacaoForm === "comprar") {
          totalUSDForm = valorUSDFormBase + taxaServicoForm;
          textoOperacaoForm = "Total aproximado a pagar";
        } else {
          totalUSDForm = valorUSDFormBase - taxaServicoForm;
          textoOperacaoForm = "Total aproximado a receber";
        }

        totalPYGFormFinal = totalUSDForm * rates.USD_PYG;
        totalBRLFormFinal = totalUSDForm * rates.USD_BRL;
      } else if (moedaForm === "PYG") {
        const precoSitePYG = rates.USD_PYG * (1 + spreadPercent);
        const usdPeloSiteForm = valorPYGForm / precoSitePYG;

        if (tipoOperacaoForm === "comprar") {
          textoOperacaoForm = "USD aproximado a pagar";
          totalUSDForm = usdPeloSiteForm;
        } else {
          textoOperacaoForm = "USD aproximado a receber";
          totalUSDForm = usdPeloSiteForm;
        }

        totalPYGFormFinal = valorPYGForm;
        totalBRLFormFinal = totalUSDForm * rates.USD_BRL;
      }

      const texto = `
*Novo pedido P2P - Bitcoin Câmbio P2P*

Nome: ${nome}
Telefone do cliente: ${telefoneCliente}

Operação: ${tipoOperacaoForm === "comprar" ? "Comprar" : "Vender"}
Tipo: ${moedaForm === "PYG" ? "Câmbio físico (Guaranis)" : "Criptomoeda - " + moedaForm}
Forma de pagamento: ${pagamento}

Valor base em PYG: ${valorPYGForm.toFixed(0)} PYG
Valor base aproximado em USD: ${valorUSDFormBase.toFixed(2)} USD
Valor base aproximado em BRL: R$ ${valorBRLFormBase.toFixed(2)}

Preço estimado utilizado: ${isCriptoForm ? "US$ " + precoFinal.toFixed(2) + " por 1 " + moedaForm : rates.USD_PYG.toFixed(0) + " PYG por 1 USD"}

${isCriptoForm ? `Quantidade aproximada: ${quantidadeForm.toFixed(8)} ${moedaForm}` : ""}

${isCriptoForm ? `Taxa de serviço (5% sobre o valor em USD): ${taxaServicoForm.toFixed(2)} USD` : "Sem taxa de 5% (câmbio físico em Guaranis)"}

${textoOperacaoForm}: 
• ~ ${totalUSDForm.toFixed(2)} USD
• ~ ${totalPYGFormFinal.toFixed(0)} PYG
• ~ R$ ${totalBRLFormFinal.toFixed(2)}

Observações: ${observacoes || "Nenhuma"}
      `.trim();

      // TROCAR PELO SEU NÚMERO DE WHATSAPP DO PARAGUAI (SÓ NÚMEROS, COM DDI 595)
      const seuNumeroWhatsApp = "595991398215";

      const url = `https://wa.me/${seuNumeroWhatsApp}?text=${encodeURIComponent(texto)}`;
      window.open(url, "_blank");
    });

    // =========================
    // INICIALIZAÇÃO
    // =========================

    fetchRates();
    setInterval(fetchRates, 60000);
  </script>
</body>
</html>
