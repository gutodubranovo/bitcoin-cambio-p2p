<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Bitcoin Câmbio P2P</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #02030a;
      color: #f5f5f5;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }

    .hero {
      position: relative;
      border-radius: 18px;
      padding: 18px 16px 20px;
      margin-top: 12px;
      margin-bottom: 10px;
      overflow: hidden;
      background: radial-gradient(circle at top left, #ffb300 0, #ff6f00 20%, #0b1020 55%, #02030a 100%);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.18;
      background:
        linear-gradient(120deg, transparent 0 40%, rgba(255,255,255,0.15) 50%, transparent 60%),
        repeating-linear-gradient(
          -8deg,
          rgba(255,255,255,0.12) 0,
          rgba(255,255,255,0.12) 2px,
          transparent 2px,
          transparent 10px
        );
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 60%;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(2, 3, 10, 0.65);
      backdrop-filter: blur(6px);
      margin-bottom: 8px;
    }

    .logo-mark {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.1rem;
      background: radial-gradient(circle at 30% 20%, #fff8e1 0, #ff9800 45%, #e65100 100%);
      color: #1b1400;
      box-shadow: 0 0 12px rgba(255, 193, 7, 0.9);
    }

    .logo-text {
      font-weight: 700;
      font-size: 0.95rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #ffecb3;
    }

    .hero-title {
      margin: 2px 0 4px;
      font-size: 1.6rem;
      font-weight: 800;
      color: #fff8e1;
    }

    .hero-subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: #ffe0b2;
    }

    .hero-note {
      margin-top: 6px;
      font-size: 0.75rem;
      color: #ffe0b2;
      opacity: 0.9;
    }

    .hero-cartoon {
      position: absolute;
      right: -10px;
      bottom: -4px;
      width: 260px;
      max-width: 50%;
      opacity: 0.5;
      border-radius: 999px;
      background: radial-gradient(circle at top, #ffcc80 0, #ff9800 40%, #0b1020 75%);
    }

    .hero-cartoon::after {
      content: "Ponte da Amizade · estilo cartoon";
      position: absolute;
      left: 10%;
      top: 15%;
      width: 80%;
      text-align: center;
      font-size: 0.7rem;
      color: rgba(10,10,20,0.85);
      font-weight: 600;
    }

    .card {
      background: #050816;
      border-radius: 14px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255,255,255,0.04);
    }

    .section-title {
      margin: 0;
      font-size: 1.15rem;
      color: #ffb300;
    }

    .section-subtitle {
      margin: 4px 0 0;
      font-size: 0.8rem;
      color: #c7c7c7;
    }

    .ticker {
      font-size: 0.8rem;
      margin-top: 8px;
      padding: 8px;
      border-radius: 8px;
      background: #02030f;
      border: 1px solid #222842;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #0b1020;
      font-size: 0.75rem;
      color: #e0e0e0;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #e0e0e0;
    }

    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #222842;
      background: #050816;
      color: #f5f5f5;
      font-size: 0.95rem;
    }

    input:focus, select:focus, textarea:focus {
      outline: 2px solid #ffb300;
      outline-offset: 1px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .col-6 {
      flex: 1 1 220px;
    }

    .results {
      margin-top: 12px;
      padding: 10px;
      background: #02030f;
      border-radius: 8px;
      font-size: 0.9rem;
      border: 1px solid #222842;
    }

    .results strong {
      color: #ffb300;
    }

    .btn-whatsapp {
      margin-top: 16px;
      background: #25d366;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-whatsapp:hover {
      filter: brightness(1.1);
    }

    .small-text {
      font-size: 0.8rem;
      color: #b0b0b0;
      margin-top: 6px;
    }

    footer {
      text-align: center;
      font-size: 0.75rem;
      color: #777;
      margin: 24px 0 8px;
    }

    .toggle-btn {
      margin-top: 10px;
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #444b70;
      background: #050816;
      color: #e0e0e0;
      cursor: pointer;
      width: auto;
    }

    .toggle-btn:hover {
      background: #11152a;
    }

    #fxSection {
      margin-top: 10px;
      display: none;
    }

    @media (max-width: 720px) {
      .hero-content {
        max-width: 100%;
      }
      .hero-cartoon {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HERO -->
    <section class="hero">
      <div class="hero-content">
        <div class="logo">
          <span class="logo-mark">₿</span>
          <span class="logo-text">Bitcoin Câmbio P2P</span>
        </div>
        <h1 class="hero-title">Cripto e câmbio em Ciudad del Este</h1>
        <p class="hero-subtitle">
          Bitcoin, Ethereum e USDT com pagamento em Guaranis ou PIX em Real.
        </p>
        <p class="hero-note">
          Taxa de serviço de <strong>5% nas operações em criptomoedas</strong>. Câmbio físico sem taxa extra.
        </p>
      </div>
      <div class="hero-cartoon"></div>
    </section>

    <!-- COTAÇÕES RESUMIDAS -->
    <section class="card">
      <header>
        <h2 class="section-title">Cotações rápidas</h2>
        <p class="section-subtitle">
          Valores aproximados para referência no atendimento.
        </p>
      </header>
      <div class="ticker" id="ticker">
        Carregando cotações...
      </div>
    </section>

    <!-- CALCULADORA CRIPTO P2P -->
    <section class="card">
      <header>
        <h2 class="section-title">Simulador de Cripto P2P</h2>
        <p class="section-subtitle">
          Digite o valor em <strong>Guaranis (PYG)</strong> para saber quanto paga ou recebe em cripto.
        </p>
      </header>

      <div class="row" style="margin-top: 8px;">
        <div class="col-6">
          <label for="moeda">Criptomoeda</label>
          <select id="moeda">
            <option value="BTC">BTC - Bitcoin</option>
            <option value="ETH">ETH - Ethereum</option>
            <option value="USDT">USDT - Tether</option>
          </select>
        </div>
        <div class="col-6">
          <label for="tipoOperacao">Operação</label>
          <select id="tipoOperacao">
            <option value="comprar">Comprar cripto</option>
            <option value="vender">Vender cripto</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="col-6">
          <label for="valorPYG">Valor em Guaranis (PYG)</label>
          <input type="number" id="valorPYG" placeholder="Ex: 1000000" step="1" min="0" />
          <div class="small-text" id="equivalenteUSD">
            Equivalente aproximado em USD: -
          </div>
          <div class="small-text" id="equivalenteBRL">
            Equivalente aproximado em BRL: -
          </div>
        </div>
      </div>

      <div class="results" id="resultadoCotacao">
        Informe um valor em PYG para simular.
      </div>
    </section>

    <!-- BOTÃO PARA CÂMBIO FÍSICO -->
    <section class="card">
      <header>
        <h2 class="section-title">Câmbio físico (opcional)</h2>
        <p class="section-subtitle">
          Use apenas se o cliente quiser trocar dinheiro (USD / BRL / PYG).
        </p>
      </header>

      <button class="toggle-btn" id="toggleFxBtn">Mostrar simulador de câmbio físico</button>

      <div id="fxSection">
        <div class="row" style="margin-top: 10px;">
          <div class="col-6">
            <label for="fxDirecao">Tipo de operação</label>
            <select id="fxDirecao">
              <option value="USD_PYG">USD → PYG</option>
              <option value="BRL_PYG">BRL → PYG</option>
              <option value="PYG_USD">PYG → USD</option>
              <option value="PYG_BRL">PYG → BRL</option>
            </select>
          </div>
          <div class="col-6">
            <label for="fxValor">Valor</label>
            <input type="number" id="fxValor" placeholder="Ex: 100 (USD/BRL) ou 100000 (PYG)" step="0.01" min="0" />
          </div>
        </div>

        <div class="results" id="fxResultado">
          Informe um valor para simular o câmbio físico.
        </div>
      </div>
    </section>

    <!-- FORMULÁRIO P2P -->
    <section class="card">
      <header>
        <h2 class="section-title">Enviar pedido pelo WhatsApp</h2>
        <p class="section-subtitle">
          Preencha e envie, você será direcionado para o WhatsApp com os dados prontos.
        </p>
      </header>

      <div class="row" style="margin-top: 10px;">
        <div class="col-6">
          <label for="nome">Nome completo</label>
          <input type="text" id="nome" placeholder="Seu nome" />
        </div>
        <div class="col-6">
          <label for="telefone">Telefone (WhatsApp)</label>
          <input type="tel" id="telefone" placeholder="+595 9xx xxx xxx" />
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="col-6">
          <label for="moedaForm">Tipo de operação</label>
          <select id="moedaForm">
            <option value="BTC">BTC - Bitcoin</option>
            <option value="ETH">ETH - Ethereum</option>
            <option value="USDT">USDT - Tether</option>
            <option value="PYG">PYG - Câmbio físico</option>
          </select>
        </div>

        <div class="col-6">
          <label for="tipoOperacaoForm">Comprar ou vender</label>
          <select id="tipoOperacaoForm">
            <option value="comprar">Comprar</option>
            <option value="vender">Vender</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="col-6">
          <label for="valorPYGForm">Valor em Guaranis (PYG)</label>
          <input type="number" id="valorPYGForm" placeholder="Ex: 500000" step="1" min="0" />
        </div>
        <div class="col-6">
          <label for="pagamento">Forma de pagamento</label>
          <select id="pagamento">
            <option value="Pix BRL">Pix em Real (BRL)</option>
            <option value="Pix PYG">Pix em Guaranis (PYG)</option>
            <option value="Dinheiro">Dinheiro (efectivo)</option>
            <option value="Criptomoedas">Criptomoedas</option>
          </select>
        </div>
      </div>

      <label style="margin-top: 12px;" for="observacoes">Observações (opcional)</label>
      <textarea id="observacoes" rows="3" placeholder="Banco, horário, rede da cripto, etc."></textarea>

      <button class="btn-whatsapp" id="btnWhatsapp">
        Enviar pedido para o WhatsApp
      </button>

      <div class="small-text">
        Confirme sempre os dados de depósito antes de enviar valores.
      </div>
    </section>

    <footer>
      Bitcoin Câmbio P2P · Atendimento P2P em Ciudad del Este.
    </footer>
  </div>

  <script>
    const spreadPercent = 0.01;        // 1% só na compra de cripto
    const taxaCryptoPercent = 0.05;    // 5% em cripto (compra e venda)

    const rates = { BTC: null, ETH: null, USDT: 1, USD_PYG: null, USD_BRL: null };

    const tickerDiv = document.getElementById("ticker");
    const resultadoCotacaoDiv = document.getElementById("resultadoCotacao");
    const equivalenteUSDSpan = document.getElementById("equivalenteUSD");
    const equivalenteBRLSpan = document.getElementById("equivalenteBRL");

    const moedaSelect = document.getElementById("moeda");
    const tipoOperacaoSelect = document.getElementById("tipoOperacao");
    const valorPYGInput = document.getElementById("valorPYG");

    const fxDirecaoSelect = document.getElementById("fxDirecao");
    const fxValorInput = document.getElementById("fxValor");
    const fxResultadoDiv = document.getElementById("fxResultado");

    const toggleFxBtn = document.getElementById("toggleFxBtn");
    const fxSection = document.getElementById("fxSection");

    function formatMoney(value, decimals = 2) {
      return value.toLocaleString("pt-BR", { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
    }
    function isCrypto(moeda) {
      return ["BTC","ETH","USDT"].includes(moeda);
    }

    async function fetchRates() {
      try {
        const [btcRes, ethRes, fxRes] = await Promise.all([
          fetch("https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT"),
          fetch("https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT"),
          fetch("https://open.er-api.com/v6/latest/USD")
        ]);
        const btcData = await btcRes.json();
        const ethData = await ethRes.json();
        const fxData = await fxRes.json();

        if (btcData && btcData.price) rates.BTC = parseFloat(btcData.price);
        if (ethData && ethData.price) rates.ETH = parseFloat(ethData.price);
        if (fxData && fxData.rates) {
          if (fxData.rates.PYG) rates.USD_PYG = parseFloat(fxData.rates.PYG);
          if (fxData.rates.BRL) rates.USD_BRL = parseFloat(fxData.rates.BRL);
        }
        if (!rates.USD_PYG) rates.USD_PYG = 7500;
        if (!rates.USD_BRL) rates.USD_BRL = 5.5;

        atualizarTicker();
        atualizarSimulacaoCripto();
        atualizarCambioFisico();
      } catch (e) {
        console.error("Erro ao buscar cotações:", e);
        if (!rates.BTC) rates.BTC = 70000;
        if (!rates.ETH) rates.ETH = 3500;
        if (!rates.USD_PYG) rates.USD_PYG = 7500;
        if (!rates.USD_BRL) rates.USD_BRL = 5.5;
        tickerDiv.textContent = "Usando cotações aproximadas.";
        atualizarSimulacaoCripto();
        atualizarCambioFisico();
      }
    }

    function atualizarTicker() {
      if (!rates.USD_PYG || !rates.USD_BRL) {
        tickerDiv.textContent = "Carregando cotações...";
        return;
      }
      const parts = [];
      if (rates.BTC) parts.push(`<span class="badge"><strong>BTC</strong> ~ US$ ${formatMoney(rates.BTC)}</span>`);
      if (rates.ETH) parts.push(`<span class="badge"><strong>ETH</strong> ~ US$ ${formatMoney(rates.ETH)}</span>`);
      parts.push(`<span class="badge"><strong>USDT</strong> US$ 1,00</span>`);
      parts.push(`<span class="badge"><strong>1 USD ≈</strong> ${formatMoney(rates.USD_PYG,0)} PYG</span>`);
      parts.push(`<span class="badge"><strong>1 USD ≈</strong> R$ ${formatMoney(rates.USD_BRL)}</span>`);
      tickerDiv.innerHTML = parts.join("");
    }

    function atualizarSimulacaoCripto() {
      const moeda = moedaSelect.value;
      const tipoOperacao = tipoOperacaoSelect.value;
      const valorPYG = parseFloat(valorPYGInput.value || "0");

      if (!rates.USD_PYG || !rates.USD_BRL) {
        resultadoCotacaoDiv.textContent = "Aguardando cotações em tempo real...";
        return;
      }

      if (!valorPYG || valorPYG <= 0) {
        resultadoCotacaoDiv.textContent = "Informe um valor em PYG para simular.";
        equivalenteUSDSpan.textContent = "Equivalente aproximado em USD: -";
        equivalenteBRLSpan.textContent = "Equivalente aproximado em BRL: -";
        return;
      }

      const valorUSDbase = valorPYG / rates.USD_PYG;
      const valorBRLbase = valorUSDbase * rates.USD_BRL;

      equivalenteUSDSpan.textContent = `Equivalente aproximado em USD: US$ ${formatMoney(valorUSDbase)}`;
      equivalenteBRLSpan.textContent = `Equivalente aproximado em BRL: R$ ${formatMoney(valorBRLbase)}`;

      if (!isCrypto(moeda)) {
        resultadoCotacaoDiv.textContent = "Selecione uma criptomoeda válida.";
        return;
      }

      if (moeda === "BTC" && !rates.BTC) { resultadoCotacaoDiv.textContent = "Cotação de BTC indisponível."; return; }
      if (moeda === "ETH" && !rates.ETH) { resultadoCotacaoDiv.textContent = "Cotação de ETH indisponível."; return; }

      const precoRef = (moeda==="BTC") ? rates.BTC : (moeda==="ETH") ? rates.ETH : 1;

      let precoUsado;
      if (tipoOperacao === "comprar") {
        precoUsado = (moeda==="BTC" || moeda==="ETH") ? precoRef*(1+spreadPercent) : precoRef;
      } else {
        precoUsado = precoRef; // venda sem spread
      }

      const quantidade = valorUSDbase / precoUsado;
      const taxaServico = valorUSDbase * taxaCryptoPercent;

      let totalUSD, textoOperacao;
      if (tipoOperacao === "comprar") {
        totalUSD = valorUSDbase + taxaServico;
        textoOperacao = "Total aproximado a pagar";
      } else {
        totalUSD = valorUSDbase - taxaServico;
        textoOperacao = "Total aproximado a receber";
      }

      const totalPYGFinal = totalUSD * rates.USD_PYG;
      const totalBRLFinal = totalUSD * rates.USD_BRL;

      resultadoCotacaoDiv.innerHTML = `
        <div><strong>${tipoOperacao === "comprar" ? "Compra" : "Venda"} de ${moeda}</strong></div>
        <div>Quantidade aproximada: <strong>${quantidade.toFixed(8)} ${moeda}</strong></div>
        <div>Taxa de serviço (5%): <strong>US$ ${formatMoney(taxaServico)}</strong></div>
        <div style="margin-top:6px;">
          ${textoOperacao}:<br>
          • <strong>US$ ${formatMoney(totalUSD)}</strong><br>
          • ~ <strong>${formatMoney(totalPYGFinal,0)} PYG</strong><br>
          • ~ <strong>R$ ${formatMoney(totalBRLFinal)}</strong>
        </div>
      `;
    }

    function atualizarCambioFisico() {
      const direcao = fxDirecaoSelect.value;
      const valor = parseFloat(fxValorInput.value || "0");

      if (!rates.USD_PYG || !rates.USD_BRL) {
        fxResultadoDiv.textContent = "Aguardando cotações em tempo real...";
        return;
      }

      if (!valor || valor <= 0) {
        fxResultadoDiv.textContent = "Informe um valor para simular o câmbio físico.";
        return;
      }

      let texto = "";

      if (direcao === "USD_PYG") {
        const valorUSD = valor;
        const valorPYG = valorUSD * rates.USD_PYG;
        texto = `
          <div>Você entrega: <strong>US$ ${formatMoney(valorUSD)}</strong></div>
          <div>Você recebe: <strong>${formatMoney(valorPYG,0)} PYG</strong></div>
        `;
      } else if (direcao === "BRL_PYG") {
        const valorBRL = valor;
        const valorUSD = valorBRL / rates.USD_BRL;
        const valorPYG = valorUSD * rates.USD_PYG;
        texto = `
          <div>Você entrega: <strong>R$ ${formatMoney(valorBRL)}</strong></div>
          <div>Você recebe: <strong>${formatMoney(valorPYG,0)} PYG</strong></div>
        `;
      } else if (direcao === "PYG_USD") {
        const valorPYG = valor;
        const valorUSD = valorPYG / rates.USD_PYG;
        texto = `
          <div>Você entrega: <strong>${formatMoney(valorPYG,0)} PYG</strong></div>
          <div>Você recebe: <strong>US$ ${formatMoney(valorUSD)}</strong></div>
        `;
      } else if (direcao === "PYG_BRL") {
        const valorPYG = valor;
        const valorUSD = valorPYG / rates.USD_PYG;
        const valorBRL = valorUSD * rates.USD_BRL;
        texto = `
          <div>Você entrega: <strong>${formatMoney(valorPYG,0)} PYG</strong></div>
          <div>Você recebe: <strong>R$ ${formatMoney(valorBRL)}</strong></div>
        `;
      }

      fxResultadoDiv.innerHTML = texto + `
        <div class="small-text" style="margin-top:6px;">
          Câmbio físico sem taxa de 5%. Valores aproximados.
        </div>
      `;
    }

    moedaSelect.addEventListener("change", atualizarSimulacaoCripto);
    tipoOperacaoSelect.addEventListener("change", atualizarSimulacaoCripto);
    valorPYGInput.addEventListener("input", atualizarSimulacaoCripto);

    fxDirecaoSelect.addEventListener("change", atualizarCambioFisico);
    fxValorInput.addEventListener("input", atualizarCambioFisico);

    toggleFxBtn.addEventListener("click", () => {
      if (fxSection.style.display === "none" || fxSection.style.display === "") {
        fxSection.style.display = "block";
        toggleFxBtn.textContent = "Esconder simulador de câmbio físico";
      } else {
        fxSection.style.display = "none";
        toggleFxBtn.textContent = "Mostrar simulador de câmbio físico";
      }
    });

    document.getElementById("btnWhatsapp").addEventListener("click", function () {
      const nome = document.getElementById("nome").value.trim();
      const telefoneCliente = document.getElementById("telefone").value.trim();
      const moedaForm = document.getElementById("moedaForm").value;
      const tipoOperacaoForm = document.getElementById("tipoOperacaoForm").value;
      const valorPYGForm = parseFloat(document.getElementById("valorPYGForm").value || "0");
      const pagamento = document.getElementById("pagamento").value;
      const observacoes = document.getElementById("observacoes").value.trim();

      if (!nome || !telefoneCliente || !valorPYGForm || valorPYGForm <= 0) {
        alert("Preencha nome, telefone e valor em PYG para enviar o pedido.");
        return;
      }
      if (!rates.USD_PYG || !rates.USD_BRL) {
        alert("Cotações ainda não carregadas. Tente novamente.");
        return;
      }

      const isCriptoForm = isCrypto(moedaForm);
      const valorUSDFormBase = valorPYGForm / rates.USD_PYG;
      const valorBRLFormBase = valorUSDFormBase * rates.USD_BRL;

      let precoRef = 1;
      if (moedaForm === "BTC") precoRef = rates.BTC || 70000;
      if (moedaForm === "ETH") precoRef = rates.ETH || 3500;
      if (moedaForm === "USDT") precoRef = 1;
      if (moedaForm === "PYG") precoRef = rates.USD_PYG;

      let precoUsado;
      if (isCriptoForm) {
        if (tipoOperacaoForm === "comprar") {
          precoUsado = (moedaForm==="BTC"||moedaForm==="ETH") ? precoRef*(1+spreadPercent) : precoRef;
        } else {
          precoUsado = precoRef; // venda sem spread
        }
      } else {
        precoUsado = rates.USD_PYG; // câmbio físico referência
      }

      let taxaServicoForm = 0;
      let totalUSDForm = valorUSDFormBase;
      let totalPYGFormFinal = valorPYGForm;
      let totalBRLFormFinal = valorBRLFormBase;
      let quantidadeForm = 0;
      let textoOperacaoForm;

      if (isCriptoForm) {
        quantidadeForm = valorUSDFormBase / precoUsado;
        taxaServicoForm = valorUSDFormBase * taxaCryptoPercent;

        if (tipoOperacaoForm === "comprar") {
          totalUSDForm = valorUSDFormBase + taxaServicoForm;
          textoOperacaoForm = "Total aproximado a pagar";
        } else {
          totalUSDForm = valorUSDFormBase - taxaServicoForm;
          textoOperacaoForm = "Total aproximado a receber";
        }

        totalPYGFormFinal = totalUSDForm * rates.USD_PYG;
        totalBRLFormFinal = totalUSDForm * rates.USD_BRL;
      } else {
        const usdPeloSiteForm = valorPYGForm / rates.USD_PYG;
        totalUSDForm = usdPeloSiteForm;
        textoOperacaoForm = tipoOperacaoForm==="comprar" ? "USD aproximado a pagar" : "USD aproximado a receber";
        totalPYGFormFinal = valorPYGForm;
        totalBRLFormFinal = totalUSDForm * rates.USD_BRL;
      }

      const texto = `
*Novo pedido P2P - Bitcoin Câmbio P2P*

Nome: ${nome}
Telefone do cliente: ${telefoneCliente}

Operação: ${tipoOperacaoForm === "comprar" ? "Comprar" : "Vender"}
Tipo: ${moedaForm === "PYG" ? "Câmbio físico (Guaranis)" : "Criptomoeda - " + moedaForm}
Forma de pagamento: ${pagamento}

Valor em PYG: ${valorPYGForm.toFixed(0)} PYG
Valor aproximado em USD: ${valorUSDFormBase.toFixed(2)} USD
Valor aproximado em BRL: R$ ${valorBRLFormBase.toFixed(2)}

Preço usado: ${isCriptoForm ? "US$ " + precoUsado.toFixed(2) + " por 1 " + moedaForm : rates.USD_PYG.toFixed(0) + " PYG por 1 USD"}

${isCriptoForm ? `Quantidade aproximada: ${quantidadeForm.toFixed(8)} ${moedaForm}` : ""}

${isCriptoForm ? `Taxa de serviço (5% sobre o valor em USD): ${taxaServicoForm.toFixed(2)} USD` : "Sem taxa de 5% (câmbio físico)"}

${textoOperacaoForm}: 
• ~ ${totalUSDForm.toFixed(2)} USD
• ~ ${totalPYGFormFinal.toFixed(0)} PYG
• ~ R$ ${totalBRLFormFinal.toFixed(2)}

Observações: ${observacoes || "Nenhuma"}
      `.trim();

      const seuNumeroWhatsApp = "595991398215"; // TROCA AQUI
      const url = `https://wa.me/${seuNumeroWhatsApp}?text=${encodeURIComponent(texto)}`;
      window.open(url, "_blank");
    });

    fetchRates();
    setInterval(fetchRates, 60000);
  </script>
</body>
</html>
